<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Diet Sodas: A Deep Dive into the Causal Effect of Artificial Sweeteners on Obesity</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="report_files/libs/clipboard/clipboard.min.js"></script>
<script src="report_files/libs/quarto-html/quarto.js"></script>
<script src="report_files/libs/quarto-html/popper.min.js"></script>
<script src="report_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="report_files/libs/quarto-html/anchor.min.js"></script>
<link href="report_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="report_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="report_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="report_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="report_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
</head><body>\usepackage{setspace}
\doublespacing






<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#abstract" id="toc-abstract" class="nav-link active" data-scroll-target="#abstract"><span class="header-section-number">1</span> Abstract</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction"><span class="header-section-number">2</span> Introduction</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data"><span class="header-section-number">3</span> Data</a></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods"><span class="header-section-number">4</span> Methods</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results"><span class="header-section-number">5</span> Results</a></li>
  <li><a href="#conclusions" id="toc-conclusions" class="nav-link" data-scroll-target="#conclusions"><span class="header-section-number">6</span> Conclusions</a></li>
  <li><a href="#future-work" id="toc-future-work" class="nav-link" data-scroll-target="#future-work"><span class="header-section-number">7</span> Future Work</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="report.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Diet Sodas: A Deep Dive into the Causal Effect of Artificial Sweeteners on Obesity</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Chase Clemence </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">8 Aug 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="abstract" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="abstract"><span class="header-section-number">1</span> Abstract</h2>
<p>The obesity epidemic remains a pressing public health concern in the United States, and many food and beverage companies have capitalized on this crisis by marketing products that appeal to consumers’ desire to lose weight. Among these, diet sodas have long been advertised as healthier alternatives to sugary beverages, often promoted on the basis that they contain zero calories. To achieve this, diet sodas are sweetened with non-caloric, and potentially addictive, artificial sweeteners such as sucralose and aspartame. Although these sweeteners do not contribute directly to caloric intake, several medical studies and expert analyses suggest that diet sodas may contribute to weight gain. This study aims to construct a comprehensive probabilistic graphical model (PGM) to estimate the causal impact of diet soda consumption on Body Mass Index (BMI). Using data from the National Health and Nutrition Examination Survey (NHANES) for the 2013–2014 survey cycle, this analysis provides a longitudinal view of participants’ dietary habits. Covariates related to each participant’s demographics, income, fitness regiment, weight history, and overall diet were controlled to understand a the true causal impact. Results from the PGM suggest that individuals who regularly consume diet soda also increase their BMIs (<strong>this is intuition rn</strong>). These findings offer important implications for public health policy, suggesting the need for stronger regulation of the diet beverage industry and greater encouragement of healthier drink alternatives for individuals struggling with obesity.</p>
</section>
<section id="introduction" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="introduction"><span class="header-section-number">2</span> Introduction</h2>
<p>Obesity is a growing public health issue in the United States, with the epidemic continuing to worsen each year. According to the Centers for Disease Control and Prevention (CDC), the majority of U.S. states reported an obesity prevalence of over 30%, indicating that nearly one-third of Americans have a Body Mass Index (BMI) of 30 or higher <span class="citation" data-cites="cdc_adult_obesity_maps">(<a href="#ref-cdc_adult_obesity_maps" role="doc-biblioref">Centers for Disease Control and Prevention (CDC) 2024</a>)</span>. Although obesity is a nationwide concern, it is especially concentrated in the Midwest and South. In Texas, for instance, approximately 52% of males aged 15–24 were classified as overweight or obese in 2021. Even more striking, nearly 80% of men over the age of 25 in North Dakota were considered at least overweight. Future projections for the American obesity epidemic are more troubling. By the year 2050, it is estimated that one-fifth of children (ages 5–15), one-third of adolescents (ages 15–24), and two-thirds of adults (ages 25 and older) will be classified as obese <span class="citation" data-cites="ihme_lancet_obesity2050">(<a href="#ref-ihme_lancet_obesity2050" role="doc-biblioref">Institute for Health Metrics and Evaluation (IHME) 2024</a>)</span>. While BMI is not a perfect measure of health—often misclassifying highly muscular individuals and senior citizens—it remains a broadly accepted indicator of population-level health trends. Although genetics may predispose some individuals to higher weight, obesity in the U.S. is primarily driven by the foods and beverages that Americans regularly consume.</p>
<p>The fast-paced American lifestyle encourages reliance on processed and ultra-processed foods, which are made affordable and accessible by the fast-food and packaged food industries. According to Dr.&nbsp;Leigh Frame—program director for the Integrative Medicine Programs and a clinical researcher at George Washington University—this dietary pattern is closely tied to weight gain, elevated fasting blood glucose, microbiome disruptions, and other health complications <span class="citation" data-cites="laster_frame_2019">(<a href="#ref-laster_frame_2019" role="doc-biblioref">Laster and Frame 2019</a>)</span>. Regarding weight gain specifically, Frame and her colleagues cite a controlled inpatient study in which 20 adults were randomly assigned to follow either an ultra-processed or an unprocessed diet for two weeks. These diets were nutritionally matched in perceived calories, sugar, fat, fiber, and macronutrient content, yet participants on the ultra-processed diet consumed significantly more energy overall, particularly from carbohydrates and fats. This led to an average weight gain of 0.9 kg (p = 0.009), while those on the unprocessed diet lost a similar amount (p = 0.007) <span class="citation" data-cites="hall2019ultra">(<a href="#ref-hall2019ultra" role="doc-biblioref">Hall et al. 2019</a>)</span>. These findings underscore the impact of food processing on energy intake and weight. While diet sodas are often marketed as a healthier alternative to sugary drinks, they remain ultra-processed and may pose similar risks.</p>
<p>Beverage companies often tout diet sodas as a zero-calorie, health-conscious choice. For example, PepsiCo’s finance chief in 2023 claimed that aspartame-sweetened drinks “obviously have the benefit of being zero calorie” <span class="citation" data-cites="Rajesh2023">(<a href="#ref-Rajesh2023" role="doc-biblioref">Rajesh 2023</a>)</span>. However, a careful look at the science reveals more nuance. In a 2022 meta-analysis of randomized trials, McGlynn <em>et al.</em> found that substituting low- or no-calorie drinks for sugar-sweetened sodas led to only a small average weight loss (about –1.06 kg) <span class="citation" data-cites="McGlynn2022">(<a href="#ref-McGlynn2022" role="doc-biblioref">McGlynn et al. 2022</a>)</span>. By contrast, large cohort studies consistently link frequent diet-soda consumption with higher risks of weight gain, diabetes, and cardiovascular disease <span class="citation" data-cites="McGlynn2022">(<a href="#ref-McGlynn2022" role="doc-biblioref">McGlynn et al. 2022</a>)</span>. In addition, Toews <em>et al.</em> (2019) reported that evidence from clinical and observational studies is generally low quality and shows essentially no long-term benefit of artificial sweeteners on weight <span class="citation" data-cites="Toews2019">(<a href="#ref-Toews2019" role="doc-biblioref">Toews et al. 2019</a>)</span>. In fact, some data suggest diet-drink users may even compensate by eating more or experience altered metabolism—for example, sweeteners can disrupt normal appetite signaling and gut microbiota in ways that promote weight gain <span class="citation" data-cites="McGlynn2022">(<a href="#ref-McGlynn2022" role="doc-biblioref">McGlynn et al. 2022</a>)</span>. Despite industry claims suggesting otherwise <span class="citation" data-cites="Rajesh2023">(<a href="#ref-Rajesh2023" role="doc-biblioref">Rajesh 2023</a>)</span>, scientific reviews indicate that drinking diet sodas is not clearly protective against obesity and may be associated with lasting metabolic harms <span class="citation" data-cites="McGlynn2022 Toews2019">(<a href="#ref-McGlynn2022" role="doc-biblioref">McGlynn et al. 2022</a>; <a href="#ref-Toews2019" role="doc-biblioref">Toews et al. 2019</a>)</span>.</p>
<p>This paper explores the causal impact of diet soda consumption on weight gain, addressing a public health issue that remains largely shrouded in uncertainty. While many consumers believe they are making a healthier choice by switching to diet alternatives, the evidence presented here suggests that diet soda may cause more harm than good in the long term.</p>
</section>
<section id="data" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="data"><span class="header-section-number">3</span> Data</h2>
<p>All data used in this analysis were obtained from the National Health and Nutrition Examination Survey (NHANES), a nationally representative program that collects detailed information on the dietary habits and nutrient intake of U.S. residents. NHANES employs a rigorous methodology, compiling a wide range of data including demographic information, dietary intake, physical examination findings, laboratory results, self-reported questionnaire responses, and more. This study focuses on a subset of these variables—specifically demographics, financial status, physical fitness indicators, self-perceived diet quality, and weight history—as potential confounders.</p>
<p>To increase reliability, NHANES provides two non-consecutive 24-hour dietary recall datasets for each participant, spaced approximately 30 days apart. Although NHANES is conducted annually using consistent data collection protocols, the quality and completeness of post-pandemic data have declined. For this reason, data from the 2013–2014 cycle were selected for this analysis, though the methods described here are generalizable to other NHANES cycles.</p>
<p>The data cleaning process began with familiarization with NHANES food codes to accurately identify participants who reported consuming diet soda. Once these specific codes were isolated, participants were categorized accordingly. Relevant covariates were then merged using the SEQN variable, a unique identifier assigned to each participant. This integration enabled a structured and meaningful examination of diet-related patterns and outcomes. The table below outlines the names and definitions of specific variables used.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 29%">
<col style="width: 70%">
</colgroup>
<thead>
<tr class="header">
<th>Variable Name</th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>SEQN</strong></td>
<td>Respondent sequence number</td>
</tr>
<tr class="even">
<td><strong>SODADRINKER</strong></td>
<td>A boolean variable that identifies if a respondent drinks diet soda</td>
</tr>
<tr class="odd">
<td><strong>BMXBMI</strong></td>
<td>Body Mass Index (kg/m**2)</td>
</tr>
<tr class="even">
<td><strong>RIAGENDR</strong></td>
<td>Gender of the participant</td>
</tr>
<tr class="odd">
<td><strong>RIDRETH1</strong></td>
<td>Reported race and Hispanic origin information</td>
</tr>
<tr class="even">
<td><strong>RIDAGEYR</strong></td>
<td>Age in years of the participant at the time of screening</td>
</tr>
<tr class="odd">
<td><strong>DMDEDU2</strong></td>
<td>Education level (Adults 20+)</td>
</tr>
<tr class="even">
<td><strong>IND235</strong></td>
<td>Compare outcomes of diet soda consumers vs.&nbsp;non-consumers using covariates</td>
</tr>
<tr class="odd">
<td><strong>PAQ610</strong></td>
<td>Number of days per week where vigorous activity is involved</td>
</tr>
<tr class="even">
<td><strong>PAQ625</strong></td>
<td>Number of days per week where moderate activity is involved</td>
</tr>
<tr class="odd">
<td><strong>WHQ060</strong></td>
<td>Binary variable specifying if weight change is intentional</td>
</tr>
<tr class="even">
<td><strong>DBQ700</strong></td>
<td>Categorical variable specifying the healthiness of the participant’s diet</td>
</tr>
</tbody>
</table>
</section>
<section id="methods" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="methods"><span class="header-section-number">4</span> Methods</h2>
<p>This is the section where I will detail my developed probabilistic graphical model, outlining what covariates are forks, pipes, colliders, and proxies. I will discuss how I used logistic regression as well as propensity scores to make a sound model and conduct thoughtful analysis. I will also detail what variables I wanted to interact with each other.</p>
</section>
<section id="results" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="results"><span class="header-section-number">5</span> Results</h2>
<p>Here, I will discuss the results objectively. I will show the ROCs of a benchmark model compared to the more complex model. I will conduct a sensitivity analysis with the priors of the model, determining which prior probability distributions yield the best results given personal and professional intuitions about the public health sector. I will also outline the results of potential counterfactual scenarios, such as when everyone or no one</p>
</section>
<section id="conclusions" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="conclusions"><span class="header-section-number">6</span> Conclusions</h2>
<p>Based on the results, in which I expect there to be a direct relationship between diet soda consumption and an increase in BMI, I would urge policymakers to regulate the soda industry for the sake of American public health. I will re-cite my obesity statistics, discussing how regulation could help slow this troublesome trend. I would also urge policymakers to incentivize healthier eating habits overall as well as attempt to make healthier foods cheaper, as ultra-processed foods are a hindrance to public health.</p>
</section>
<section id="future-work" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="future-work"><span class="header-section-number">7</span> Future Work</h2>
<p>In this section, I will discuss how similar analysis should be conducted across a variety of different years. I will also discuss how the inclusion of additional variables can add depth to the analysis. This is because the ‘causal diagram’ will be more comprehensive, therefore better capturing the true causal effect. It must be stated that these included variables should NOT be colliders, as this will negatively impact the causal findings.</p>
<p>If future researchers want to pivot from obesity, there are other perceived negative effects from diet soda that could be causally studied (e.g.&nbsp;on metabolic health, gut hormones, incident diabetes, etc).</p>

</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-cdc_adult_obesity_maps" class="csl-entry" role="listitem">
Centers for Disease Control and Prevention (CDC). 2024. <span>“Adult Obesity Prevalence Maps.”</span> <a href="https://www.cdc.gov/obesity/data-and-statistics/adult-obesity-prevalence-maps.html" class="uri">https://www.cdc.gov/obesity/data-and-statistics/adult-obesity-prevalence-maps.html</a>.
</div>
<div id="ref-hall2019ultra" class="csl-entry" role="listitem">
Hall, Kevin D., Abraham Ayuketah, Robert Brychta, Hongyi Cai, Tyler Cassimatis, Kyle Y. Chen, Seongwon T. Chung, et al. 2019. <span>“Ultra-Processed Diets Cause Excess Calorie Intake and Weight Gain: An Inpatient Randomized Controlled Trial of Ad Libitum Food Intake.”</span> <em>Cell Metabolism</em> 30 (1): 67–77.e3. <a href="https://doi.org/10.1016/j.cmet.2019.05.008">https://doi.org/10.1016/j.cmet.2019.05.008</a>.
</div>
<div id="ref-ihme_lancet_obesity2050" class="csl-entry" role="listitem">
Institute for Health Metrics and Evaluation (IHME). 2024. <span>“Without Immediate Action, Nearly 260 Million People in the u.s. Predicted to Be Overweight or Obese by 2050.”</span> <a href="https://www.healthdata.org/news-events/newsroom/news-releases/lancet-without-immediate-action-nearly-260-million-people-usa" class="uri">https://www.healthdata.org/news-events/newsroom/news-releases/lancet-without-immediate-action-nearly-260-million-people-usa</a>.
</div>
<div id="ref-laster_frame_2019" class="csl-entry" role="listitem">
Laster, Janese, and Leigh A. Frame. 2019. <span>“Beyond the Calories—Is the Problem in the Processing?”</span> <em>Current Treatment Options in Gastroenterology</em> 17 (4): 577–86. <a href="https://doi.org/10.1007/s11938-019-00246-1">https://doi.org/10.1007/s11938-019-00246-1</a>.
</div>
<div id="ref-McGlynn2022" class="csl-entry" role="listitem">
McGlynn, N. D., T. A. Khan, L. Wang, R. Zhang, L. Chiavaroli, F. Au-Yeung, J. J. Lee, et al. 2022. <span>“Association of Low- and No-Calorie Sweetened Beverages as a Replacement for Sugar-Sweetened Beverages with Body Weight and Cardiometabolic Risk: A Systematic Review and Meta-Analysis.”</span> <em>JAMA Network Open</em> 5 (3): e222092. <a href="https://doi.org/10.1001/jamanetworkopen.2022.2092">https://doi.org/10.1001/jamanetworkopen.2022.2092</a>.
</div>
<div id="ref-Rajesh2023" class="csl-entry" role="listitem">
Rajesh, Ananya Mariam. 2023. <span>“PepsiCo Says It Has No Plans to Change Its Portfolio as WHO Set to Warn on Aspartame Sweeteners.”</span> <em>Reuters</em>. <a href="https://www.reuters.com/business/retail-consumer/pepsico-says-no-plans-change-portfolio-who-set-warn-aspartame-sweeteners-2023-07-13/">https://www.reuters.com/business/retail-consumer/pepsico-says-no-plans-change-portfolio-who-set-warn-aspartame-sweeteners-2023-07-13/</a>.
</div>
<div id="ref-Toews2019" class="csl-entry" role="listitem">
Toews, I., S. Lohner, D. Küllenberg de Gaudry, H. Sommer, and J. J. Meerpohl. 2019. <span>“Association Between Intake of Non-Sugar Sweeteners and Health Outcomes: Systematic Review and Meta-Analyses of Randomized and Non-Randomized Controlled Trials and Observational Studies.”</span> <em>BMJ</em> 364: k4718. <a href="https://doi.org/10.1136/bmj.k4718">https://doi.org/10.1136/bmj.k4718</a>.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>